service: griffin-autoscheduler-service

provider:
  name: aws
  memorySize: 128
  environment:
    AWS_REGION_T: !Ref AWS::Region
    AUTO_RECORD_TABLE: !ImportValue RecordAutoRecordTable
    AGGREGATE_CURRENT_YOUTUBER_LIVE_TABLE: !ImportValue AggregateLiveTable

    AUTO_RECORD_TABLEArn: !ImportValue RecordAutoRecordTableArn
    AGGREGATE_CURRENT_YOUTUBER_LIVE_TABLEArn: !ImportValue AggregateLiveTableArn
    RECORD_REQUEST_TABLE: !ImportValue RecordRequestTable
    RECORD_RECORD_USERNAME_INDEX: !ImportValue RecordRequestUsernameIndexName
  
  iamRoleStatements:
    - Effect: Allow
      Action:
        - dynamodb:Query
        - dynamodb:Scan
        - dynamodb:GetItem
        - dynamodb:PutItem
        - dynamodb:UpdateItem
        - dynamodb:DeleteItem
      Resource: !ImportValue RecordAutoRecordTableArn
    - Effect: Allow
      Action:
        - dynamodb:Query
        - dynamodb:Scan
        - dynamodb:GetItem
        - dynamodb:PutItem
        - dynamodb:UpdateItem
        - dynamodb:DeleteItem
      Resource: !ImportValue AggregateLiveTableArn
    - Effect: Allow
      Action:
        - dynamodb:*
      Resource: !ImportValue RecordRequestTableArn
    - Effect: Allow
      Action:
        - dynamodb:*
      Resource: !ImportValue RecordRequestUsernameIndex
  

functions:
  checkSchedule:
    handler: src/checkSchedule.handler
    events:
      - schedule: rate(1 minute)